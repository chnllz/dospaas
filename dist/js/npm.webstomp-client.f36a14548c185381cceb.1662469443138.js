(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["npm.webstomp-client"],{c6e1:function(e,t,n){(function(t,n){e.exports=n()})(0,(function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=function(){function e(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done);r=!0)if(n.push(s.value),t&&n.length===t)break}catch(c){i=!0,a=c}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},i={V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.2,1.1,1.0"},supportedProtocols:function(){return["v10.stomp","v11.stomp","v12.stomp"]}},a={"v10.stomp":i.V1_0,"v11.stomp":i.V1_1,"v12.stomp":i.V1_2};function s(e,t){var n=a[e];return!n&&t&&t("DEPRECATED: "+e+" is not a recognized STOMP version. In next major client version, this will close the connection."),n||i.V1_2}var o={LF:"\n",NULL:"\0"},c=function(e){return e.replace(/^\s+|\s+$/g,"")};function u(e){var t=encodeURIComponent(e),n=t.replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})),r=Array.prototype.map.call(n,(function(e){return e.charCodeAt(0)}));return new Uint8Array(r)}function h(e){var t=String.fromCharCode.apply(String,r(e)),n=t.replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}));return decodeURIComponent(n)}function l(e){return e?encodeURIComponent(e).match(/%..|./g).length:0}function d(){var e=(new Date).getTime(),t=Math.floor(1e3*Math.random());return e+"-"+t}var v=function(){function n(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";e(this,n),this.command=t,this.headers=r,this.body=i}return t(n,[{key:"toString",value:function(){var e=this,t=[this.command],n=!1===this.headers["content-length"];return n&&delete this.headers["content-length"],Object.keys(this.headers).forEach((function(n){var r=e.headers[n];t.push(n+":"+r)})),this.body&&!n&&t.push("content-length:"+l(this.body)),t.push(o.LF+this.body),t.join(o.LF)}}],[{key:"unmarshallSingle",value:function(e){var t=e.search(new RegExp(o.LF+o.LF)),r=e.substring(0,t).split(o.LF),i=r.shift(),a={},s="",u=t+2,h=!0,l=!1,d=void 0;try{for(var v,f=r.reverse()[Symbol.iterator]();!(h=(v=f.next()).done);h=!0){var g=v.value,b=g.indexOf(":");a[c(g.substring(0,b))]=c(g.substring(b+1))}}catch(k){l=!0,d=k}finally{try{!h&&f.return&&f.return()}finally{if(l)throw d}}if(a["content-length"]){var p=parseInt(a["content-length"],10);s=(""+e).substring(u,u+p)}else for(var m=null,y=u;y<e.length;y++){if(m=e.charAt(y),m===o.NULL)break;s+=m}return new n(i,a,s)}},{key:"unmarshall",value:function(e){var t=e.split(new RegExp(o.NULL+o.LF+"*")),r=t.slice(0,-1),i=t.slice(-1)[0],a={frames:r.map((function(e){return n.unmarshallSingle(e)})),partial:""};return i===o.LF||-1!==i.search(RegExp(o.NULL+o.LF+"*$"))?a.frames.push(n.unmarshallSingle(i)):a.partial=i,a}},{key:"marshall",value:function(e,t,r){var i=new n(e,t,r);return i.toString()+o.NULL}}]),n}(),f=function(){function r(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,r);var i=n.binary,a=void 0!==i&&i,s=n.heartbeat,o=void 0===s?{outgoing:1e4,incoming:1e4}:s,c=n.debug,u=void 0===c||c,h=n.protocols,l=void 0===h?[]:h;this.ws=t,this.ws.binaryType="arraybuffer",this.isBinary=!!a,this.hasDebug=!!u,this.connected=!1,this.heartbeat=o||{outgoing:0,incoming:0},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData="",this.protocols=l}return t(r,[{key:"debug",value:function(){var e;this.hasDebug&&(e=console).log.apply(e,arguments)}},{key:"connect",value:function(){var e=this,t=this._parseConnect.apply(this,arguments),r=n(t,3),a=r[0],c=r[1],u=r[2];this.connectCallback=c,this.debug("Opening Web Socket..."),this.ws.onmessage=function(t){var n=t.data;if(t.data instanceof ArrayBuffer&&(n=h(new Uint8Array(t.data))),e.serverActivity=Date.now(),n!==o.LF){e.debug("<<< "+n);var r=v.unmarshall(e.partialData+n);e.partialData=r.partial,r.frames.forEach((function(t){switch(t.command){case"CONNECTED":e.debug("connected to server "+t.headers.server),e.connected=!0,e.version=t.headers.version,e._setupHeartbeat(t.headers),c&&c(t);break;case"MESSAGE":var n=t.headers.subscription,r=e.subscriptions[n]||e.onreceive;if(r){var a=e.version===i.V1_2&&t.headers.ack||t.headers["message-id"];t.ack=e.ack.bind(e,a,n),t.nack=e.nack.bind(e,a,n),r(t)}else e.debug("Unhandled received MESSAGE: "+t);break;case"RECEIPT":e.onreceipt&&e.onreceipt(t);break;case"ERROR":u&&u(t);break;default:e.debug("Unhandled frame: "+t)}}))}else e.debug("<<< PONG")},this.ws.onclose=function(t){e.debug("Whoops! Lost connection to "+e.ws.url+":",{event:t}),e._cleanUp(),u&&u(t)},this.ws.onopen=function(){e.debug("Web Socket Opened..."),a["accept-version"]=s(e.ws.protocol||e.protocols[0],e.debug.bind(e)),a["heart-beat"]||(a["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(",")),e._transmit("CONNECT",a)},this.ws.readyState===this.ws.OPEN&&this.ws.onopen()}},{key:"disconnect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),e&&e()}},{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({},n);r.destination=e,this._transmit("SEND",r,t)}},{key:"begin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"tx-"+d();return this._transmit("BEGIN",{transaction:e}),{id:e,commit:this.commit.bind(this,e),abort:this.abort.bind(this,e)}}},{key:"commit",value:function(e){this._transmit("COMMIT",{transaction:e})}},{key:"abort",value:function(e){this._transmit("ABORT",{transaction:e})}},{key:"ack",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({},n),a=this.version===i.V1_2?"id":"message-id";r[a]=e,r.subscription=t,this._transmit("ACK",r)}},{key:"nack",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({},n),a=this.version===i.V1_2?"id":"message-id";r[a]=e,r.subscription=t,this._transmit("NACK",r)}},{key:"subscribe",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({},n);return r.id||(r.id="sub-"+d()),r.destination=e,this.subscriptions[r.id]=t,this._transmit("SUBSCRIBE",r),{id:r.id,unsubscribe:this.unsubscribe.bind(this,r.id)}}},{key:"unsubscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object.assign({},t);delete this.subscriptions[e],n.id=e,this._transmit("UNSUBSCRIBE",n)}},{key:"_cleanUp",value:function(){this.connected=!1,clearInterval(this.pinger),clearInterval(this.ponger)}},{key:"_transmit",value:function(e,t,n){var r=v.marshall(e,t,n);this.debug(">>> "+r,{frame:{command:e,headers:t,body:n}}),this._wsSend(r)}},{key:"_wsSend",value:function(e){this.isBinary&&(e=u(e)),this.debug(">>> length "+e.length);while(1){if(!(e.length>this.maxWebSocketFrameSize))return this.ws.send(e);this.ws.send(e.slice(0,this.maxWebSocketFrameSize)),e=e.slice(this.maxWebSocketFrameSize),this.debug("remaining = "+e.length)}}},{key:"_setupHeartbeat",value:function(e){var t=this;if(this.version===i.V1_1||this.version===i.V1_2){var r=(e["heart-beat"]||"0,0").split(",").map((function(e){return parseInt(e,10)})),a=n(r,2),s=a[0],c=a[1];if(0!==this.heartbeat.outgoing&&0!==c){var u=Math.max(this.heartbeat.outgoing,c);this.debug("send PING every "+u+"ms"),this.pinger=setInterval((function(){t._wsSend(o.LF),t.debug(">>> PING")}),u)}if(0!==this.heartbeat.incoming&&0!==s){var h=Math.max(this.heartbeat.incoming,s);this.debug("check PONG every "+h+"ms"),this.ponger=setInterval((function(){var e=Date.now()-t.serverActivity;e>2*h&&(t.debug("did not receive server activity for the last "+e+"ms"),t.ws.close())}),h)}}}},{key:"_parseConnect",value:function(){for(var e={},t=void 0,n=void 0,r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];switch(i.length){case 2:e=i[0],t=i[1];break;case 3:i[1]instanceof Function?(e=i[0],t=i[1],n=i[2]):(e.login=i[0],e.passcode=i[1],t=i[2]);break;case 4:e.login=i[0],e.passcode=i[1],t=i[2],n=i[3];break;default:e.login=i[0],e.passcode=i[1],t=i[2],n=i[3],e.host=i[4]}return[e,t,n]}}]),r}(),g={Frame:v,VERSIONS:i,client:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new WebSocket(e,t.protocols||i.supportedProtocols());return new f(n,t)},over:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(f,[null].concat(t)))}};return g}))}}]);